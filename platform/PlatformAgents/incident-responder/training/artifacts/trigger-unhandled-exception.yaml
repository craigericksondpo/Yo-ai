# 3. Incident-Responder trigger and contract
# Incident-Responder subscribes to sentinel.incident.alert and has policy driven authority to terminate or restart things.
# 3.1 Trigger definition
# incident-responder/triggers/unhandled-exception.yaml
trigger_id: incident_responder.trigger.unhandled_exception.v1
description: >
  Trigger the Incident-Responder workflow when The-Sentinel emits an unhandled exception alert.

input_event:
  type: sentinel.incident.alert
  version: 1

filter:
  expression: >
    event.alert_type == "unhandled_exception"
    and event.severity in ["medium", "high", "critical"]

on_match:
  start_workflow:
    workflow_id: incident_responder.workflow.unhandled_exception_response.v1
    input_mapping:
      incident_id: "{{ event.incident_id }}"
      severity: "{{ event.severity }}"
      classification: "{{ event.classification }}"
      recommendation: "{{ event.recommendation }}"
      source_event_id: "{{ event.source_event_id }}"
      source_event_type: "{{ event.source_event_type }}"
      trace_links: "{{ event.trace_links }}"